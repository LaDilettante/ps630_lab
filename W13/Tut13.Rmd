---
title: "Tutorial 13: Autocorrelation, Fixed vs. Random Effects, and Causal Inference Techniques"
author: "Jan Vogler (jan.vogler@duke.edu)"
date: "November 20, 2015"
output: pdf_document
---

# Today's Agenda

1. Autocorrelation
2. Fixed-effects vs. random-effects regression
3. Differences-in-differences
4. Regression discontinuity designs



# 1. Autocorrelation

Create lags of dependent and independent variables for panel datasets with DataCombine.

Let us first load the LDC dataset.

```{r,tidy=TRUE}
setwd('C:/Users/Jan/OneDrive/Documents/GitHub/ps630_lab/')
library(foreign)
LDC=read.dta("LDC_IO_replication.dta")
```

The DataCombine package is designed for data management, especially time series and panel data. It allows us to easily generate lags of our dependent variable. We might want to generate lags of our dependent variable to control for autocorrelation.

install.packages("DataCombine")

```{r,tidy=TRUE,error=TRUE}
library(DataCombine)

which()

toLag = c()

for (lagVar in toLag){
combi1=slide(combi1, Var=lagVar, TimeVar="year", GroupVar="stcode", NewVar=paste0("lag1_",lagVar), slideBy = -1, keepInvalid = FALSE, reminder = TRUE)
}

for (lagVar in toLag){
  combi1=slide(combi1, Var=lagVar, TimeVar="year", GroupVar="stcode", NewVar=paste0("lag2_",lagVar), slideBy = -2, keepInvalid = FALSE, reminder = TRUE)
}

for (lagVar in toLag){
  combi1=slide(combi1, Var=lagVar, TimeVar="year", GroupVar="stcode", NewVar=paste0("lag3_",lagVar), slideBy = -3, keepInvalid = FALSE, reminder = TRUE)
}
```

Let us now work with a regression that we have already seen in past tutorials and homeworks to illustrate the phenomenon of autocorrelation.

```{r,tidy=TRUE}
main=lm(newtar ~ l1polity + l1signed + l1office + l1gdp_pc + l1lnpop + l1ecris2 + l1bpc1 + l1avnewtar + factor(ctylabel), data = LDC)
summary(main)
```

Durbin-Watson Test

```{r}
library(car)
DurbinWatson(main)
```

Newey West Standard Errors

install.packages("sandwich")
install.packages("lmtest")

```{r}
library(lmtest)
coeftest(model, NeweyWest(model, lag=3))
```



# 2. Fixed-effects vs. random-effects regression

We have seen fixed effects previously. We can simply integrate fixed effects by using the factor() command.

```{r}
lm()
```

Now let's introduce RE.

```{r}
library(lme4)
lmer(Health ~ lag1_lpr + lag1_lpr2 + (1 + lag1_lpr + lag1_lpr2 | Country), data=combi4)
summary(random1)
```



# 3. Differences-in-differences

Differences-in-differences analysis makes use of parallel time trends.



# 4. Regression discontinuity designs

Regression discontinuity designs are powerful tools for causal inference.

install.packages("rdd")

```{r,tidy=TRUE}
library(rdd)
```



## Remember

```{r,tidy=TRUE}
fun=c("R","is","fun")
paste(fun, collapse=" ")
```